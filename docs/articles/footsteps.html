<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic building footprint calculations • foot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic building footprint calculations">
<meta property="og:description" content="Building footprints or polygons representing the outline shape of structures can provide a unique data source for studying urban areas at high spatial resolutions. This vignette will introduce the `foot` package and demonstrate some of the tools provided to calculate summary measures of geometric properties and to produce tabular, zonal, and gridded outputs.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">foot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/footsteps.html">footsteps: Getting started</a>
    </li>
    <li>
      <a href="../articles/bigfoot.html">bigfoot: Gridded footprint calculations</a>
    </li>
    <li>
      <a href="../articles/cobbler.html">cobbler: Using custom summary functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wpgp/foot/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="footsteps_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic building footprint calculations</h1>
            
            <h4 class="date">November 10, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wpgp/foot/blob/master/vignettes/footsteps.Rmd"><code>vignettes/footsteps.Rmd</code></a></small>
      <div class="hidden name"><code>footsteps.Rmd</code></div>

    </div>

    
    
<p>The <code>foot</code> package was developed by WorldPop at the University of Southampton (<a href="https://www.worldpop.org">www.worldpop.org</a>) to provide a set of consistent and flexible tools for processing 2D vector representations of buildings (e.g. “footprints”) and calculating urban morphology measurements. The functionality includes basic geometry and morphology characteristics, distance and clustering metrics. These calculations are supported with helper functions for spatial intersections and tiled reading/writing of data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wpgp/foot">foot</a></span><span class="op">)</span></code></pre></div>
<p>This vignette will demonstrate some of the core functionality in the package, including:</p>
<ul>
<li>The available measurements and summary statistics</li>
<li>How to define different types of spatial zones for area-level summaries</li>
<li>Calculating multiple summary metrics for a set of spatial areas</li>
<li>Example workflows to produce outputs using <code><a href="../reference/calculate_footstats.html">foot::calculate_footstats()</a></code>.</li>
</ul>
<p>To demonstrate the package, this vignette will use a supplied sample of building footprint polygons produced by Microsoft Bing Maps (<a href="https://github.com/microsoft/Uganda-Tanzania-Building-Footprints">Source</a>) from an area in Kampala, Uganda. These footprints have been reprocessed into a spatial data format which can be read with <code>sf</code>.</p>
<div id="load-the-sample-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-sample-dataset" class="anchor"></a>Load the sample dataset</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"kampala"</span>, package <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span>

<span class="va">buildings</span> <span class="op">&lt;-</span> <span class="va">kampala</span><span class="op">$</span><span class="va">buildings</span>
<span class="va">adminzones</span> <span class="op">&lt;-</span> <span class="va">kampala</span><span class="op">$</span><span class="va">adminZones</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="va">kampala</span><span class="op">$</span><span class="va">clusters</span></code></pre></div>
<p>The sample dataset is a list of four named objects:</p>
<ul>
<li>“buildings” - polygons of building footprints in <code>sf</code> format. Contains 8480 records.</li>
<li>“mastergrid” - geoTiff <code>RasterLayer</code> aligned to WorldPop datalayers. This will be used as a template for producing other gridded outputs</li>
<li>“adminZones” - 34 polygons in <code>sf</code> format for zonal statistics</li>
<li>“clusters” - 10 small polygons in <code>sf</code> format for sample sites</li>
</ul>
<p>Note that the adminZones and cluster boundaries are purely artificial and were created for demonstration purposes only.</p>
<p>For more information, see <code><a href="../reference/kampala.html">?kampala</a></code>.</p>
<div class="figure">
<img src="footsteps_files/figure-html/fsFig1-1.png" alt="Sample buildings and zones in Kampala" width="576"><p class="caption">
Sample buildings and zones in Kampala
</p>
</div>
</div>
<div id="calculations-with-foot" class="section level2">
<h2 class="hasAnchor">
<a href="#calculations-with-foot" class="anchor"></a>Calculations with <code>foot</code>
</h2>
<p>The core functions of <code>foot</code> are provided by <code><a href="../reference/calculate_footstats.html">calculate_footstats()</a></code>. The operations include: 1) calculating geometry measures for each footprint, 2) summarising one or more geometry measures of footprints within zones. The simplest usage involves supplying a set of building footprint polygons and the desired characteristics to calculate. All operations return the same format - a <code>data.table</code>, optionally with a column for the index and the named column for the summarised footprint metric(s).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the area and perimeter of each building footprint</span>
<span class="va">built_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"area"</span>, <span class="st">"perimeter"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Selecting metrics </span>
<span class="co">#&gt; Setting control values. </span>
<span class="co">#&gt; Pre-calculating areas </span>
<span class="co">#&gt; Pre-calculating perimeters </span>
<span class="co">#&gt; No summary functions found, returning metrics.</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">built_area</span><span class="op">)</span>
<span class="co">#&gt;               area    perimeter</span>
<span class="co">#&gt; 1:  22.10707 [m^2] 19.26045 [m]</span>
<span class="co">#&gt; 2: 221.37976 [m^2] 67.95023 [m]</span>
<span class="co">#&gt; 3:  39.13247 [m^2] 25.37269 [m]</span>
<span class="co">#&gt; 4: 388.48091 [m^2] 98.55654 [m]</span>
<span class="co">#&gt; 5: 351.14738 [m^2] 82.22555 [m]</span>
<span class="co">#&gt; 6: 164.74579 [m^2] 55.87172 [m]</span></code></pre></div>
<p>To summarise the footprint characteristics over all building polygons, the name of a summary function, or a list of multiple functions can be supplied.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the average and standard deviation of all building areas</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, what <span class="op">=</span> <span class="st">"area"</span>, how <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Selecting metrics </span>
<span class="co">#&gt; Setting control values. </span>
<span class="co">#&gt; Pre-calculating areas </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Calculating  2  metrics ... </span>
<span class="co">#&gt;    area mean  </span>
<span class="co">#&gt;    area sd  </span>
<span class="co">#&gt; Finished calculating metrics.</span>
<span class="co">#&gt;    zoneID      area_mean  area_sd</span>
<span class="co">#&gt; 1:      1 264.3684 [m^2] 718.4919</span></code></pre></div>
<div id="available-metrics-and-summary-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#available-metrics-and-summary-measures" class="anchor"></a>Available metrics and summary measures</h3>
<p>Currently implemented are measures for:</p>
<ul>
<li>building presence</li>
<li>area</li>
<li>perimeter</li>
<li>nearest neighbour distance</li>
<li>angle of rotation</li>
<li>compactness and shape</li>
<li>length-width ratio</li>
</ul>
<p>A table of metrics and other packaged summary function names available for each is available using <code><a href="../reference/list_fs.html">list_fs()</a></code>. The results of this function provide “cols” and “funs” which can be passed as <code>what</code> and <code>how</code> arguments, respectively, to <code>calculate_footstats</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get all available built-in functions for perimeter calculations</span>
<span class="va">argsList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_fs.html">list_fs</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"perimeter"</span><span class="op">)</span>

<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, what <span class="op">=</span> <span class="va">argsList</span><span class="op">$</span><span class="va">cols</span>, how <span class="op">=</span> <span class="va">argsList</span><span class="op">$</span><span class="va">funs</span><span class="op">)</span>
<span class="co">#&gt; Selecting metrics </span>
<span class="co">#&gt; Setting control values. </span>
<span class="co">#&gt; Pre-calculating perimeters </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Calculating  8  metrics ... </span>
<span class="co">#&gt;    perimeter cv  </span>
<span class="co">#&gt;    perimeter iqr  </span>
<span class="co">#&gt;    perimeter max  </span>
<span class="co">#&gt;    perimeter mean  </span>
<span class="co">#&gt;    perimeter median  </span>
<span class="co">#&gt;    perimeter min  </span>
<span class="co">#&gt;    perimeter sd  </span>
<span class="co">#&gt;    perimeter sum  </span>
<span class="co">#&gt; Finished calculating metrics.</span>
<span class="co">#&gt;    zoneID perimeter_cv perimeter_iqr perimeter_max perimeter_mean</span>
<span class="co">#&gt; 1:      1    0.9396027      40.81674  1089.097 [m]   62.22027 [m]</span>
<span class="co">#&gt;    perimeter_median perimeter_min perimeter_sd perimeter_sum</span>
<span class="co">#&gt; 1:     46.68314 [m]  14.88332 [m]     58.46233  301146.1 [m]</span></code></pre></div>
<p>With no other argument supplied, all the footprints are treated as coming from the same spatial zone for any summary function. A later section describes the process for identifying zones.</p>
</div>
</div>
<div id="additional-characteristics-and-geometry-measures" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-characteristics-and-geometry-measures" class="anchor"></a>Additional characteristics and geometry measures</h2>
<p>Whenever possible, <code>foot</code> makes use of generic functions within <code>R</code>. Most low-level geometry calculations rely on <code>sf</code>, <code>geos</code>, <code>lwgeom</code> and users need to have recent versions of these packages installed. There are other stand-alone functions within <code>foot</code> to support more complex or less-common measurements.</p>
<div id="nearest-neighbour-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#nearest-neighbour-distances" class="anchor"></a>Nearest neighbour distances</h3>
<p>Distances can be calculated between footprints, or between footprints and other spatial objects. The distances can be measured edge-to-edge (<code>method = "poly"</code>) or the centroids of the building footprints can be used (<code>method = "centroid"</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># nearest distance for the first 10 buildings to any other building measured</span>
<span class="co"># between polygon edges</span>
<span class="fu"><a href="../reference/fs_nndist.html">fs_nndist</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, <span class="va">buildings</span>, maxSearch <span class="op">=</span> <span class="fl">200</span>, unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span>
<span class="co">#&gt; Units: [m]</span>
<span class="co">#&gt;  [1]  3.9782228  7.9372980  1.0249509 22.3497210  2.4816995 16.2608819</span>
<span class="co">#&gt;  [7]  0.9555975  1.8666478  2.6156498  2.3014386</span>

<span class="co"># omitting argument 'Y' measures distance among the footprints supplied setting</span>
<span class="co"># maxSearch=NULL removes the search restriction</span>
<span class="fu"><a href="../reference/fs_nndist.html">fs_nndist</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, method <span class="op">=</span> <span class="st">"centroid"</span>, maxSearch <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="co">#&gt; Units: [m]</span>
<span class="co">#&gt;  [1] 100.15489 100.15489  90.59004  90.59004 117.26008 117.26008 218.52524</span>
<span class="co">#&gt;  [8] 228.62489 218.52524 440.20521</span></code></pre></div>
<p>Note that distance calculations are slower for polygons and for unprojected coordinate systems. The centroid-based calculations are faster. It is recommended that a maximum search radius is always used. Internally the calculations are done with a <code>data.table</code> to benefit from multi-threading capabilities.</p>
</div>
<div id="rotation-angles" class="section level3">
<h3 class="hasAnchor">
<a href="#rotation-angles" class="anchor"></a>Rotation angles</h3>
<p>A less conventional geometric measure is derived from the rotated bounding rectangle. This is the rectangle enclosing a footprint polygon which has been rotated to minimise the area. In contrast, a “bounding box” for a polygon is always oriented along the x and y axes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># To obtain the rotated rectangle as a spatial object</span>
<span class="va">mbr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fs_mbr.html">fs_mbr</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">[</span><span class="fl">4502</span>, <span class="op">]</span>, returnShape <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">[</span><span class="fl">4502</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mbr</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig2-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Or obtain just the angle measure</span>
<span class="fu"><a href="../reference/fs_mbr.html">fs_mbr</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">[</span><span class="fl">4502</span>, <span class="op">]</span>, returnShape <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt; [1] 153.0991</span></code></pre></div>
<p>The angles can be summarised as an entropy measure and normalised to describe how much the angles of a set of structures depart from a regular grid pattern (available in <code>calculate_footstats</code> where <code>how = "entropy"</code>).</p>
</div>
</div>
<div id="creating-and-supplying-zone-indices" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-and-supplying-zone-indices" class="anchor"></a>Creating and supplying zone indices</h2>
<p>Rather than treating all footprints features as belonging to a single summary zone, it’s more common to want to summarise metrics within smaller areas. There are several ways to supply information on the zones.</p>
<div id="index-by-vector" class="section level3">
<h3 class="hasAnchor">
<a href="#index-by-vector" class="anchor"></a>Index by vector</h3>
<p>A vector of indices for the zones can be supplied to <code>foot</code> functions as a 1) column name within the footprints, 2) a standalone numeric vector of indices, or 3) a spatial polygons object to join to the building footprints. The length of a vector of indices must match the number of building polygons.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a vector of ten random zones</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">buildings</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">idx</span>  <span class="co"># add it to the buildings object</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>  <span class="co"># splitting observations into 10 groups</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10 </span>
<span class="co">#&gt; 490 502 547 506 473 510 475 436 432 469</span>

<span class="co"># 1. pass the index by name</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>
<span class="co">#&gt; [1] "FID_1"    "geometry" "id"</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="st">"id"</span>, what <span class="op">=</span> <span class="st">"area"</span>, how <span class="op">=</span> <span class="st">"mean"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;     id      area_mean</span>
<span class="co">#&gt;  1:  1 277.3981 [m^2]</span>
<span class="co">#&gt;  2:  2 224.0173 [m^2]</span>
<span class="co">#&gt;  3:  3 253.2530 [m^2]</span>
<span class="co">#&gt;  4:  4 260.3614 [m^2]</span>
<span class="co">#&gt;  5:  5 298.4207 [m^2]</span>
<span class="co">#&gt;  6:  6 231.7565 [m^2]</span>
<span class="co">#&gt;  7:  7 289.4302 [m^2]</span>
<span class="co">#&gt;  8:  8 218.9365 [m^2]</span>
<span class="co">#&gt;  9:  9 317.8345 [m^2]</span>
<span class="co">#&gt; 10: 10 279.9572 [m^2]</span>

<span class="co"># 2. pass the index as a standalone vector</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">idx</span>, what <span class="op">=</span> <span class="st">"settled"</span>, how <span class="op">=</span> <span class="st">"count"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;     zoneID settled_count</span>
<span class="co">#&gt;  1:      1           490</span>
<span class="co">#&gt;  2:      2           502</span>
<span class="co">#&gt;  3:      3           547</span>
<span class="co">#&gt;  4:      4           506</span>
<span class="co">#&gt;  5:      5           473</span>
<span class="co">#&gt;  6:      6           510</span>
<span class="co">#&gt;  7:      7           475</span>
<span class="co">#&gt;  8:      8           436</span>
<span class="co">#&gt;  9:      9           432</span>
<span class="co">#&gt; 10:     10           469</span>

<span class="co"># 3. pass a separate spatial object of zones</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, zone <span class="op">=</span> <span class="va">adminzones</span>, what <span class="op">=</span> <span class="st">"angle"</span>, how <span class="op">=</span> <span class="st">"entropy"</span>,
    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;     zoneID angle_entropy</span>
<span class="co">#&gt;  1:      1    0.57343067</span>
<span class="co">#&gt;  2:      2    0.11127610</span>
<span class="co">#&gt;  3:      3    0.41727642</span>
<span class="co">#&gt;  4:      4    0.17619017</span>
<span class="co">#&gt;  5:      5    0.42197650</span>
<span class="co">#&gt;  6:      6    0.49947882</span>
<span class="co">#&gt;  7:      7    0.82533100</span>
<span class="co">#&gt;  8:      8    0.44538996</span>
<span class="co">#&gt;  9:      9    0.07920041</span>
<span class="co">#&gt; 10:     10    0.38729360</span>
<span class="co">#&gt; 11:     11    0.22977920</span>
<span class="co">#&gt; 12:     12    0.46026280</span>
<span class="co">#&gt; 13:     13    0.97518024</span>
<span class="co">#&gt; 14:     14    0.21544105</span>
<span class="co">#&gt; 15:     15    0.10321490</span>
<span class="co">#&gt; 16:     16    0.16620845</span>
<span class="co">#&gt; 17:     17    0.13136813</span>
<span class="co">#&gt; 18:     18    0.05440004</span>
<span class="co">#&gt; 19:     19    0.05390193</span>
<span class="co">#&gt; 20:     20    0.05590684</span>
<span class="co">#&gt; 21:     21    0.21223559</span>
<span class="co">#&gt; 22:     22    0.43947190</span>
<span class="co">#&gt; 23:     23    0.08843299</span>
<span class="co">#&gt; 24:     24    0.07816555</span>
<span class="co">#&gt; 25:     25    0.69100714</span>
<span class="co">#&gt; 26:     26    0.10747520</span>
<span class="co">#&gt; 27:     27    0.10629896</span>
<span class="co">#&gt; 28:     29    0.13106462</span>
<span class="co">#&gt; 29:     30    0.26117524</span>
<span class="co">#&gt; 30:     31    0.60237738</span>
<span class="co">#&gt; 31:     32    0.16687157</span>
<span class="co">#&gt; 32:     33    0.70065801</span>
<span class="co">#&gt; 33:     34    0.04253442</span>
<span class="co">#&gt;     zoneID angle_entropy</span></code></pre></div>
</div>
<div id="index-by-zone-shapes" class="section level3">
<h3 class="hasAnchor">
<a href="#index-by-zone-shapes" class="anchor"></a>Index by zone shapes</h3>
<p>Rather than supplying a pre-calculated column or vector of zonal indices, buildings can be assigned a zone based on a spatial join. When the index is created in the building footprints, it will be named “zoneID” or a user-specified name.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># examine the other objects loaded from supplied data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">adminzones</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 1 field</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 32.60589 ymin: 0.3277355 xmax: 32.62531 ymax: 0.3388665</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;   Id                       geometry</span>
<span class="co">#&gt; 1  1 POLYGON ((32.61231 0.327771...</span>
<span class="co">#&gt; 2  2 POLYGON ((32.61034 0.335317...</span>
<span class="co">#&gt; 3  3 POLYGON ((32.61592 0.327757...</span>
<span class="co">#&gt; 4  4 POLYGON ((32.6214 0.3277355...</span>
<span class="co">#&gt; 5  5 POLYGON ((32.62342 0.333760...</span>
<span class="co">#&gt; 6  6 POLYGON ((32.62498 0.335199...</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 1 field</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 32.60624 ymin: 0.3303863 xmax: 32.63375 ymax: 0.3472696</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;   Id                       geometry</span>
<span class="co">#&gt; 1  1 POLYGON ((32.6066 0.3398617...</span>
<span class="co">#&gt; 2  2 POLYGON ((32.61151 0.337602...</span>
<span class="co">#&gt; 3  3 POLYGON ((32.61028 0.331954...</span>
<span class="co">#&gt; 4  4 POLYGON ((32.61649 0.344649...</span>
<span class="co">#&gt; 5  5 POLYGON ((32.62552 0.345516...</span>
<span class="co">#&gt; 6  6 POLYGON ((32.63225 0.340927...</span>

<span class="co"># Return a table of index values based on administrative zone polygons using</span>
<span class="co"># the standalone function within `foot`</span>
<span class="va">zID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zonalIndex.html">zonalIndex</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">adminzones</span>, returnObject <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">zID</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># the xID column are row numbers to object X</span>
<span class="co">#&gt;      xID zoneID</span>
<span class="co">#&gt;  1:  463      1</span>
<span class="co">#&gt;  2:  531      1</span>
<span class="co">#&gt;  3:  848      1</span>
<span class="co">#&gt;  4: 1372      1</span>
<span class="co">#&gt;  5: 1504      1</span>
<span class="co">#&gt;  6: 1534      1</span>
<span class="co">#&gt;  7: 1859      1</span>
<span class="co">#&gt;  8: 1939      1</span>
<span class="co">#&gt;  9: 2121      1</span>
<span class="co">#&gt; 10: 2414      1</span>

<span class="co"># Alternatively (and preferably), join zones to create a new footprint object A</span>
<span class="co"># custom zone name can be used but must be specificed to the summary functions</span>
<span class="va">zObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zonalIndex.html">zonalIndex</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">clusters</span>, zoneField <span class="op">=</span> <span class="st">"Id"</span>, returnObject <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">zObj</span>
<span class="co">#&gt; Simple feature collection with 348 features and 3 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 32.60631 ymin: 0.328119 xmax: 32.63543 ymax: 0.349785</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;     FID_1 id Id                       geometry</span>
<span class="co">#&gt; 1   17706  1  1 POLYGON ((32.60662 0.339353...</span>
<span class="co">#&gt; 2   72387  1  1 POLYGON ((32.60769 0.338973...</span>
<span class="co">#&gt; 3   78504  1  1 POLYGON ((32.60703 0.338654...</span>
<span class="co">#&gt; 4  106647  1  1 POLYGON ((32.60793 0.339799...</span>
<span class="co">#&gt; 5  150833  1  1 POLYGON ((32.60712 0.338893...</span>
<span class="co">#&gt; 6  289245  1  1 POLYGON ((32.60788 0.339471...</span>
<span class="co">#&gt; 7   57187  2  1 POLYGON ((32.60827 0.338821...</span>
<span class="co">#&gt; 8   68588  2  1 POLYGON ((32.60787 0.338906...</span>
<span class="co">#&gt; 9  127999  2  1 POLYGON ((32.60707 0.339934...</span>
<span class="co">#&gt; 10 257296  2  1 POLYGON ((32.60692 0.339061...</span></code></pre></div>
<p>When using a new spatial object which has been joined to its zones, remember to supply the name of the zone field to <code>calculate_foostats</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use the new object and zone field 'Id' in a summary calculation</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">zObj</span><span class="op">)</span>
<span class="co">#&gt; [1] "FID_1"    "id"       "Id"       "geometry"</span>

<span class="va">zarea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">zObj</span>, zone <span class="op">=</span> <span class="st">"Id"</span>, what <span class="op">=</span> <span class="st">"area"</span>, how <span class="op">=</span> <span class="st">"mean"</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">clusters</span>, <span class="va">zarea</span>, by <span class="op">=</span> <span class="st">"Id"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">adminzones</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">[</span><span class="st">"area_mean"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig3-1.png" width="576"></p>
<p>The <code>zonalIndex</code> function works by spatial intersection. This produces some (potentially useful) side effects that users need to be aware of. Specifically, note that if a building footprint intersects more than 1 zone it will be duplicated and associated to all intersecting zones.</p>
<p>The default behaviour (see <code>method</code>) is to assign a building to a zone based on its <strong>centroid</strong>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note the selected structures extend beyond the cluster boundary</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">zObj</span><span class="op">[</span><span class="va">zObj</span><span class="op">$</span><span class="va">Id</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">zObj</span><span class="op">[</span><span class="va">zObj</span><span class="op">$</span><span class="va">Id</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig4-1.png" width="700"></p>
<p>Alternatively, an intersection can be used to assign footprints to any zones which are intersected. The whole footprint is associated, even if the shape is not “contained” by the zone.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note the selected structures extend beyond the cluster boundary</span>
<span class="va">zInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zonalIndex.html">zonalIndex</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">clusters</span>, zoneField <span class="op">=</span> <span class="st">"Id"</span>, method <span class="op">=</span> <span class="st">"intersect"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">zInt</span><span class="op">[</span><span class="va">zInt</span><span class="op">$</span><span class="va">Id</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig5-1.png" width="700"></p>
<p>Finally, the intersection can return a clipped set of buildings.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zClip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zonalIndex.html">zonalIndex</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">clusters</span>, zoneField <span class="op">=</span> <span class="st">"Id"</span>, method <span class="op">=</span> <span class="st">"clip"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">zClip</span><span class="op">[</span><span class="va">zClip</span><span class="op">$</span><span class="va">Id</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig6-1.png" width="700"></p>
<p>This third option clips the footprints via intersection, potentially leaving small slivers of structures in the zone which will affect the feature statistics.</p>
<p>An additional side effect of the intersection operation is that overlapping zones are allowed, and this can duplicate and associate footprints into both (overlapping) zones.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a temporary shape by shifting one cluster</span>
<span class="va">newClusters</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">1e-04</span><span class="op">)</span>, <span class="st">"POLYGON"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">)</span>

<span class="va">newClusters</span> <span class="op">&lt;-</span> <span class="fu">st_sf</span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">newClusters</span>, crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">)</span>

<span class="va">newObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zonalIndex.html">zonalIndex</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">newClusters</span>, method <span class="op">=</span> <span class="st">"clip"</span><span class="op">)</span>

<span class="co"># areas of overlap are in a purple hue</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">newClusters</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">newObj</span><span class="op">[</span><span class="va">newObj</span><span class="op">$</span><span class="va">zoneID</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">newObj</span><span class="op">[</span><span class="va">newObj</span><span class="op">$</span><span class="va">zoneID</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="footsteps_files/figure-html/fsFig7-1.png" width="700"></p>
<p>These side effects are allowed because they allow for flexibility to support types of “focal” summaries of statistics and to produce a true gridded measure of footprint metrics.</p>
</div>
</div>
<div id="calculating-multiple-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-multiple-metrics" class="anchor"></a>Calculating multiple metrics</h2>
<p>The <code><a href="../reference/calculate_footstats.html">calculate_footstats()</a></code> function provides a convenient wrapper to the individual footprint statistics and as well to <code>zonalIndex</code>. The function accepts a variety of input formats (see <code><a href="../reference/calculate_footstats.html">?calculate_footstats</a></code>). Multiple metrics can be calculated for the same sets of buildings and zones.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creates a zonal index and calculates multiple metrics</span>
<span class="co"># Use the intersection method define zones</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, 
                               zone<span class="op">=</span><span class="va">adminzones</span>, 
                               what<span class="op">=</span><span class="st">"area"</span>,
                               how<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mean"</span>,<span class="st">"cv"</span><span class="op">)</span>,
                               controlZone<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"intersect"</span><span class="op">)</span>,
                               verbose<span class="op">=</span><span class="cn">F</span>
                              <span class="op">)</span>
  <span class="va">results</span>
<span class="co">#&gt;     zoneID        area_mean   area_cv</span>
<span class="co">#&gt;  1:      1  404.40622 [m^2] 1.2479809</span>
<span class="co">#&gt;  2:      2  212.00113 [m^2] 1.1069491</span>
<span class="co">#&gt;  3:      3  527.43250 [m^2] 1.9194754</span>
<span class="co">#&gt;  4:      4  557.58574 [m^2] 3.8206699</span>
<span class="co">#&gt;  5:      5  571.26921 [m^2] 1.7000587</span>
<span class="co">#&gt;  6:      6 1026.54193 [m^2] 2.0652378</span>
<span class="co">#&gt;  7:      7 2036.80923 [m^2] 1.4077033</span>
<span class="co">#&gt;  8:      8  912.32644 [m^2] 1.4225521</span>
<span class="co">#&gt;  9:      9  182.49803 [m^2] 1.6104922</span>
<span class="co">#&gt; 10:     10  253.12878 [m^2] 1.5272719</span>
<span class="co">#&gt; 11:     11  221.10092 [m^2] 1.4300230</span>
<span class="co">#&gt; 12:     12   88.23133 [m^2] 1.2659927</span>
<span class="co">#&gt; 13:     13  664.58989 [m^2] 1.7191007</span>
<span class="co">#&gt; 14:     14   82.22200 [m^2] 0.3447115</span>
<span class="co">#&gt; 15:     15   81.14808 [m^2] 1.0115881</span>
<span class="co">#&gt; 16:     16   69.06033 [m^2] 0.5102143</span>
<span class="co">#&gt; 17:     17  139.80020 [m^2] 0.8678702</span>
<span class="co">#&gt; 18:     18   87.62864 [m^2] 1.5248900</span>
<span class="co">#&gt; 19:     19  238.14083 [m^2] 0.6189696</span>
<span class="co">#&gt; 20:     20  200.28897 [m^2] 0.9103598</span>
<span class="co">#&gt; 21:     21  245.19516 [m^2] 2.4147823</span>
<span class="co">#&gt; 22:     22  193.25951 [m^2] 0.3464272</span>
<span class="co">#&gt; 23:     23  779.48455 [m^2] 2.1447695</span>
<span class="co">#&gt; 24:     24  220.25691 [m^2] 0.7972001</span>
<span class="co">#&gt; 25:     25  508.49467 [m^2] 1.3228666</span>
<span class="co">#&gt; 26:     26 1143.07662 [m^2] 1.6994280</span>
<span class="co">#&gt; 27:     27  229.03249 [m^2] 2.2623265</span>
<span class="co">#&gt; 28:     29  239.83238 [m^2] 2.7887959</span>
<span class="co">#&gt; 29:     30  204.59597 [m^2] 0.8303153</span>
<span class="co">#&gt; 30:     31  142.77472 [m^2]        NA</span>
<span class="co">#&gt; 31:     32  273.99468 [m^2] 1.0894764</span>
<span class="co">#&gt; 32:     33  420.54389 [m^2] 0.9787568</span>
<span class="co">#&gt; 33:     34  177.61130 [m^2] 1.3707628</span>
<span class="co">#&gt;     zoneID        area_mean   area_cv</span></code></pre></div>
<p>Multiple metrics can be applied to specific groups of characteristics by providing nested lists of metrics and summary functions. The argument <code>what</code> will accept a string or a list of strings for specific metric names. Users may also supply <code>"all"</code> or <code>"nodist"</code> to calculate all available metrics or all bar the nearest neighbour distance-related ones, respectively. Excluding the distance-related metrics can speed up the calculations due to the long-running. Other performance improvements can be to set <code>controlDistance=list("method"="centroid")</code>, which uses centroid-to-centroid nearest neighbour distances rather than polygon edge-to-edge. See also, <code><a href="../reference/fs_nndist.html">?fs_nndist</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use nested lists to group characteristics and summary functions</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, 
                               zone<span class="op">=</span><span class="va">adminzones</span>, 
                               what<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"area"</span>,<span class="st">"perimeter"</span><span class="op">)</span>, 
                                         <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"settled"</span><span class="op">)</span><span class="op">)</span>,
                               how<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sum"</span>,<span class="st">"cv"</span><span class="op">)</span>, 
                                        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"count"</span><span class="op">)</span><span class="op">)</span>,
                               controlZone<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"centroid"</span><span class="op">)</span>,
                               verbose<span class="op">=</span><span class="cn">F</span>
                              <span class="op">)</span>
  <span class="va">results</span>
<span class="co">#&gt;     zoneID          area_sum   perimeter_sum   area_cv perimeter_cv</span>
<span class="co">#&gt;  1:      1   8492.5307 [m^2]  1781.62245 [m] 1.2479809    0.6561304</span>
<span class="co">#&gt;  2:      2  29892.1595 [m^2]  8596.30974 [m] 1.1069491    0.7313348</span>
<span class="co">#&gt;  3:      3  25844.1923 [m^2]  4414.86934 [m] 1.9194754    0.9811076</span>
<span class="co">#&gt;  4:      4  64122.3606 [m^2]  9640.94681 [m] 3.8206699    1.0600954</span>
<span class="co">#&gt;  5:      5  26849.6529 [m^2]  4329.10334 [m] 1.7000587    0.9581201</span>
<span class="co">#&gt;  6:      6  35928.9675 [m^2]  3835.74843 [m] 2.0652378    0.9616081</span>
<span class="co">#&gt;  7:      7  28515.3292 [m^2]  2565.09927 [m] 1.4077033    0.9286094</span>
<span class="co">#&gt;  8:      8  44703.9953 [m^2]  6348.37632 [m] 1.4225521    0.8489816</span>
<span class="co">#&gt;  9:      9  48361.9770 [m^2] 15739.78807 [m] 1.6104922    0.9246860</span>
<span class="co">#&gt; 10:     10   7593.8634 [m^2]  2087.88260 [m] 1.5272719    1.0900293</span>
<span class="co">#&gt; 11:     11  24321.1016 [m^2]  7672.66021 [m] 1.4300230    0.8815988</span>
<span class="co">#&gt; 12:     12   3123.7687 [m^2]  1403.25960 [m] 1.3014214    0.7257624</span>
<span class="co">#&gt; 13:     13   2658.3596 [m^2]   423.87801 [m] 1.7191007    1.3165558</span>
<span class="co">#&gt; 14:     14   6742.2042 [m^2]  3088.40482 [m] 0.3447115    0.2059276</span>
<span class="co">#&gt; 15:     15  19313.2428 [m^2]  8676.96497 [m] 1.0115881    0.5073846</span>
<span class="co">#&gt; 16:     16   9944.6881 [m^2]  4968.39946 [m] 0.5102143    0.3095971</span>
<span class="co">#&gt; 17:     17  14818.8207 [m^2]  5213.18182 [m] 0.8678702    0.5541695</span>
<span class="co">#&gt; 18:     18  37061.1108 [m^2] 15742.13708 [m] 1.5308487    0.7093738</span>
<span class="co">#&gt; 19:     19  96923.3173 [m^2] 26354.10548 [m] 0.6189696    0.4151437</span>
<span class="co">#&gt; 20:     20  80716.4561 [m^2] 23566.14546 [m] 0.9103598    0.5257108</span>
<span class="co">#&gt; 21:     21  18144.4417 [m^2]  4403.44976 [m] 2.4147823    0.7810948</span>
<span class="co">#&gt; 22:     22  10242.7539 [m^2]  3061.47987 [m] 0.3464272    0.2238327</span>
<span class="co">#&gt; 23:     23 133268.8176 [m^2] 17464.78357 [m] 2.1625263    1.1205392</span>
<span class="co">#&gt; 24:     24  62112.4473 [m^2] 17707.47705 [m] 0.7972001    0.5317242</span>
<span class="co">#&gt; 25:     25  11695.3775 [m^2]  2163.70761 [m] 1.3228666    0.8940386</span>
<span class="co">#&gt; 26:     26 150883.2148 [m^2] 17604.40321 [m] 1.6814458    1.0767096</span>
<span class="co">#&gt; 27:     27  33968.6861 [m^2] 10017.95165 [m] 0.7963207    0.4462858</span>
<span class="co">#&gt; 28:     29  37174.0182 [m^2]  9185.83050 [m] 2.7887959    1.0713172</span>
<span class="co">#&gt; 29:     30  15344.6975 [m^2]  4621.61764 [m] 0.8303153    0.5426390</span>
<span class="co">#&gt; 30:     31    142.7747 [m^2]    48.13661 [m]        NA           NA</span>
<span class="co">#&gt; 31:     32  35893.3028 [m^2]  9127.30909 [m] 1.0894764    0.6469339</span>
<span class="co">#&gt; 32:     33   7149.2461 [m^2]  1557.24261 [m] 0.9787568    0.6104610</span>
<span class="co">#&gt; 33:     34 147594.9907 [m^2] 47733.83601 [m] 1.3707628    0.7474269</span>
<span class="co">#&gt;     zoneID          area_sum   perimeter_sum   area_cv perimeter_cv</span>
<span class="co">#&gt;     settled_count</span>
<span class="co">#&gt;  1:            21</span>
<span class="co">#&gt;  2:           141</span>
<span class="co">#&gt;  3:            49</span>
<span class="co">#&gt;  4:           115</span>
<span class="co">#&gt;  5:            47</span>
<span class="co">#&gt;  6:            35</span>
<span class="co">#&gt;  7:            14</span>
<span class="co">#&gt;  8:            49</span>
<span class="co">#&gt;  9:           265</span>
<span class="co">#&gt; 10:            30</span>
<span class="co">#&gt; 11:           110</span>
<span class="co">#&gt; 12:            36</span>
<span class="co">#&gt; 13:             4</span>
<span class="co">#&gt; 14:            82</span>
<span class="co">#&gt; 15:           238</span>
<span class="co">#&gt; 16:           144</span>
<span class="co">#&gt; 17:           106</span>
<span class="co">#&gt; 18:           424</span>
<span class="co">#&gt; 19:           407</span>
<span class="co">#&gt; 20:           403</span>
<span class="co">#&gt; 21:            74</span>
<span class="co">#&gt; 22:            53</span>
<span class="co">#&gt; 23:           172</span>
<span class="co">#&gt; 24:           282</span>
<span class="co">#&gt; 25:            23</span>
<span class="co">#&gt; 26:           129</span>
<span class="co">#&gt; 27:           177</span>
<span class="co">#&gt; 28:           155</span>
<span class="co">#&gt; 29:            75</span>
<span class="co">#&gt; 30:             1</span>
<span class="co">#&gt; 31:           131</span>
<span class="co">#&gt; 32:            17</span>
<span class="co">#&gt; 33:           831</span>
<span class="co">#&gt;     settled_count</span></code></pre></div>
<div id="filtering-buildings" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering-buildings" class="anchor"></a>Filtering buildings</h3>
<p>In some settings it may be preferable to exclude very small and/or very large building footprint polygons. The lower and upper bounds for filtering can be specified with <code>minArea</code> and <code>maxArea</code> in the <code>filter</code> argument. The values for these filters are in the same units specified by <code>controlUnits</code> or the default value for area calculations. Note that an “area” footprint statistic does not need to be requested as this characteristic is automatically calculated to enable filtering.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filtering: # footprints must be larger than 50 m^2 and smaller than 1000 m^2</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>,
                    what<span class="op">=</span><span class="st">"perimeter"</span>,
                    how<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sum"</span><span class="op">)</span>,
                    controlUnits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>areaUnit<span class="op">=</span><span class="st">"m^2"</span><span class="op">)</span>,
                    filter<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>minArea<span class="op">=</span><span class="fl">50</span>, maxArea<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>,
                    verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>  
<span class="co">#&gt;    zoneID perimeter_mean perimeter_sum</span>
<span class="co">#&gt; 1:      1   63.06881 [m]  228561.4 [m]</span></code></pre></div>
</div>
</div>
<div id="next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next steps</h2>
<p>The <code>calculate_footstats</code> function provides the core functionality for calculating and summarising the characteristics of building footprints. It also wraps the functionality of assigning footprints to zones based on different spatial joining techniques. To go further with <code>foot</code> the concept of footprint morphology calculations can be extended to created gridded data. See <code><a href="../articles/bigfoot.html">vignette("bigfoot", package="foot")</a></code>. Additionally, users can specify their own custom summary functions to be used with <code>calculate_footstats</code>. This and other advanced options are covered in <code><a href="../articles/cobbler.html">vignette("cobbler", package="foot")</a></code>.</p>
<hr>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.1 (2021-08-10)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 20.04.3 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] sf_1.0-0 foot_0.8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.7         lattice_0.20-45    class_7.3-19       rprojroot_2.0.2   </span>
<span class="co">#&gt;  [5] digest_0.6.28      foreach_1.5.1      utf8_1.2.2         R6_2.5.1          </span>
<span class="co">#&gt;  [9] evaluate_0.14      e1071_1.7-7        highr_0.9          pillar_1.6.4      </span>
<span class="co">#&gt; [13] rlang_0.4.12       geosphere_1.5-10   data.table_1.14.2  jquerylib_0.1.3   </span>
<span class="co">#&gt; [17] rmarkdown_2.11     pkgdown_1.6.1      textshaping_0.3.5  desc_1.4.0        </span>
<span class="co">#&gt; [21] geos_0.1.1         stringr_1.4.0      proxy_0.4-26       compiler_4.1.1    </span>
<span class="co">#&gt; [25] xfun_0.27          pkgconfig_2.0.3    systemfonts_1.0.3  htmltools_0.5.2   </span>
<span class="co">#&gt; [29] tidyselect_1.1.0   tibble_3.1.5       codetools_0.2-18   fansi_0.5.0       </span>
<span class="co">#&gt; [33] crayon_1.4.2       dplyr_1.0.5        wk_0.4.1           grid_4.1.1        </span>
<span class="co">#&gt; [37] jsonlite_1.7.2     lwgeom_0.2-6       lifecycle_1.0.1    DBI_1.1.1         </span>
<span class="co">#&gt; [41] magrittr_2.0.1     formatR_1.11       units_0.7-2        KernSmooth_2.23-20</span>
<span class="co">#&gt; [45] stringi_1.7.5      cachem_1.0.6       libgeos_3.9.1-1    fs_1.5.0          </span>
<span class="co">#&gt; [49] sp_1.4-5           doParallel_1.0.16  bslib_0.2.4        ellipsis_0.3.2    </span>
<span class="co">#&gt; [53] filelock_1.0.2     ragg_1.1.3         generics_0.1.0     vctrs_0.3.8       </span>
<span class="co">#&gt; [57] s2_1.0.6           iterators_1.0.13   tools_4.1.1        glue_1.4.2        </span>
<span class="co">#&gt; [61] purrr_0.3.4        abind_1.4-5        parallel_4.1.1     fastmap_1.1.0     </span>
<span class="co">#&gt; [65] yaml_2.2.1         stars_0.5-3        classInt_0.4-3     memoise_2.0.0     </span>
<span class="co">#&gt; [69] knitr_1.36         sass_0.3.1</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by WorldPop Research Group, University of Southampton, Chris Jochem.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
